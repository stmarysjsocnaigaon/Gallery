<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Church Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .active-tab {
      background-color: #2563eb;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Header -->
  <header class="bg-blue-600 text-white py-4 shadow">
    <div class="max-w-6xl mx-auto text-center text-2xl font-bold">
      St. Mary’s Jacobite Syrian Church - Gallery
    </div>
  </header>

  <!-- Filters -->
  <section class="max-w-6xl mx-auto mt-6 px-4">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <select id="year-select" class="p-2 border rounded-lg"></select>

      <div id="category-tabs" class="flex gap-2 flex-wrap">
        <button data-category="general" class="px-3 py-1 border rounded-lg">General</button>
        <button data-category="youth" class="px-3 py-1 border rounded-lg">Youth</button>
        <button data-category="sundayschool" class="px-3 py-1 border rounded-lg">Sunday School</button>
        <button data-category="vanita" class="px-3 py-1 border rounded-lg">Vanita</button>
        <button data-category="eventwise" class="px-3 py-1 border rounded-lg">Eventwise</button>
      </div>
    </div>
  </section>

  <!-- Gallery Grid -->
  <section class="max-w-6xl mx-auto mt-6 px-4">
    <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50">
    <button id="close-lightbox" class="absolute top-6 right-6 text-white text-3xl">✕</button>
    <button id="prev-lightbox" class="absolute left-6 text-white text-3xl">❮</button>
    <button id="next-lightbox" class="absolute right-6 text-white text-3xl">❯</button>
    <div id="lightbox-content" class="max-w-4xl max-h-[90vh]"></div>
  </div>

  <script>
    function loadGallery() {
      // ✅ Direct static gallery data (replace with your own image/video links)
      const mediaData = [
        { year: 2025, category: "general", type: "image", src: "2025-General-img1.jpg" },
        { year: 2025, category: "general", type: "video", src: "videos/general1.mp4" },
        { year: 2024, category: "youth", type: "image", src: "images/youth1.jpg" },
        { year: 2024, category: "sundayschool", type: "image", src: "images/sunday1.jpg" },
        { year: 2023, category: "vanita", type: "image", src: "images/vanita1.jpg" },
        { year: 2023, category: "eventwise", type: "video", src: "videos/event1.mp4" }
      ];

      const years = [...new Set(mediaData.map(m => m.year))].sort((a,b) => b - a);
      const yearSelect = document.getElementById("year-select");
      yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join("");

      const galleryGrid = document.getElementById("gallery-grid");
      const categoryTabs = document.querySelectorAll("#category-tabs button");

      let currentFiltered = [];
      let currentIndex = 0;

      function displayGallery(year, category) {
        galleryGrid.innerHTML = "";
        currentFiltered = mediaData.filter(m => m.year == year && m.category === category);

        currentFiltered.forEach((m, i) => {
          if (m.type === "image") {
            galleryGrid.innerHTML += `<img src="${m.src}" class="w-full rounded-lg shadow-lg cursor-pointer" onclick="openLightbox(${i})">`;
          } else {
            galleryGrid.innerHTML += `
              <div class="relative cursor-pointer" onclick="openLightbox(${i})">
                <video class="w-full rounded-lg shadow-lg" preload="metadata">
                  <source src="${m.src}#t=0.5" type="video/mp4">
                </video>
                <div class="absolute inset-0 flex items-center justify-center bg-black/40 text-white text-3xl">▶</div>
              </div>`;
          }
        });
      }

      // ✅ Default view: latest year + general
      const defaultYear = years[0];
      yearSelect.value = defaultYear;
      const defaultCategory = "general";
      categoryTabs.forEach(tab => {
        if (tab.dataset.category === defaultCategory) {
          tab.classList.add("active-tab");
        } else {
          tab.classList.remove("active-tab");
        }
      });
      displayGallery(defaultYear, defaultCategory);

      // Events
      categoryTabs.forEach(tab => tab.addEventListener("click", () => {
        categoryTabs.forEach(t => t.classList.remove("active-tab"));
        tab.classList.add("active-tab");
        displayGallery(yearSelect.value, tab.dataset.category);
      }));

      yearSelect.addEventListener("change", () => {
        const activeTab = document.querySelector("#category-tabs button.active-tab");
        displayGallery(yearSelect.value, activeTab.dataset.category);
      });

      // Lightbox
      window.openLightbox = function(index) {
        currentIndex = index;
        const m = currentFiltered[index];
        const lightbox = document.getElementById("lightbox");
        const content = document.getElementById("lightbox-content");
        lightbox.classList.remove("hidden");
        content.innerHTML = m.type === "image" 
          ? `<img src="${m.src}" class="max-h-[90vh] mx-auto rounded-lg">`
          : `<video src="${m.src}" class="max-h-[90vh] mx-auto rounded-lg" controls autoplay></video>`;
      };

      document.getElementById("close-lightbox").onclick = () => {
        document.getElementById("lightbox").classList.add("hidden");
        document.getElementById("lightbox-content").innerHTML = "";
      };

      document.getElementById("prev-lightbox").onclick = () => {
        if (currentFiltered.length) {
          currentIndex = (currentIndex - 1 + currentFiltered.length) % currentFiltered.length;
          openLightbox(currentIndex);
        }
      };

      document.getElementById("next-lightbox").onclick = () => {
        if (currentFiltered.length) {
          currentIndex = (currentIndex + 1) % currentFiltered.length;
          openLightbox(currentIndex);
        }
      };
    }

    loadGallery();
  </script>
</body>
</html>
